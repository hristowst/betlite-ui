<!-- ðŸ“± Mobile Banner (collapsed) -->
<div class="betslip-banner is-hidden-desktop" *ngIf="!isExpanded" (click)="toggleExpand()">
    <span>Betslip ({{ (selections$ | async)?.length || 0 }})</span>
</div>

<!-- ðŸ“± Mobile Fullscreen Overlay -->
<div class="betslip-overlay is-hidden-desktop" *ngIf="isExpanded">

    <header class="betslip-header">
        <h2>Betslip ({{ (selections$ | async)?.length || 0 }})</h2>
        <button class="button is-light is-small" (click)="close()">âœ• Close</button>
    </header>

    <div class="betslip-content">
        <ng-container *ngTemplateOutlet="fullBetslip"></ng-container>
    </div>
</div>

<!-- ðŸ’» Desktop Sidebar -->
<div class="is-hidden-touch">
    <ng-container *ngTemplateOutlet="fullBetslip"></ng-container>
</div>

<!-- â™» Shared Betslip Content -->
<ng-template #fullBetslip>

    <section class="box" role="region" aria-label="Betslip">

        <header class="is-flex is-justify-content-space-between is-align-items-center mb-3">
            <h2 class="title is-5 m-0">Betslip</h2>

            <button class="button is-small is-light" (click)="clear()" [disabled]="(selections$ | async)?.length === 0">
                Clear
            </button>
        </header>

        <!-- Bets Selected -->
        <ng-container *ngIf="(selections$ | async) as selections; else empty">

            <div class="table-container">
                <table class="table is-fullwidth is-striped is-hoverable is-narrow" aria-label="Selected bets">
                    <thead>
                        <tr>
                            <th>Market</th>
                            <th>Selection</th>
                            <th class="has-text-right">Odds</th>
                            <th class="has-text-right" style="width: 3.5rem"></th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr *ngFor="let s of selections; trackBy: trackById">
                            <td><span class="tag">{{ s.market }}</span></td>
                            <td>{{ s.selection }}</td>

                            <td class="has-text-right">
                                {{ s.odds | number: '1.2-2' }}
                            </td>

                            <td class="has-text-right">
                                <button class="button is-ghost is-small" (click)="removeSelection(s.id)">
                                    âœ•
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Summary -->
            <div class="level">
                <div class="level-left">

                    <div class="level-item">
                        <span class="has-text-grey">Selections:</span>&nbsp;
                        <strong>{{ selections.length }}</strong>
                    </div>

                    <div class="level-item">
                        <span class="has-text-grey">Combined odds:</span>&nbsp;
                        <strong>{{ (combinedOdds$ | async) | number: '1.2-2' }}</strong>
                    </div>

                </div>
            </div>

            <!-- Stake Input -->
            <div class="level-right">
                <div class="level-item is-flex is-align-items-center">

                    <label for="stakeInput" class="mr-2 has-text-grey">
                        Stake ({{ currency }}):
                    </label>

                    <input id="stakeInput" class="input is-small" type="number" min="0" step="0.01"
                        [ngModel]="(stake$ | async) || 0" (ngModelChange)="setStake($event)" placeholder="0.00" />

                </div>
            </div>

            <!-- ðŸ’° Potential Return + Place Bet 
           (all async values unpacked BEFORE usage) -->
            <ng-container *ngIf="combinedOdds$ | async as combinedOdds">
                <ng-container *ngIf="potentialReturn$ | async as potentialReturn">
                    <ng-container *ngIf="stake$ | async as stakeValue">

                        <div class="is-flex is-justify-content-space-between is-align-items-center mt-3">

                            <div>
                                <div class="has-text-grey">Potential return</div>

                                <div class="is-size-5 has-text-weight-semibold">
                                    {{ potentialReturn | currency: currency : 'symbol' : '1.2-2' }}
                                </div>
                            </div>

                            <button class="button is-primary" [disabled]="!canPlaceBet(selections, stakeValue)"
                                (click)="onPlaceBet(selections, combinedOdds, potentialReturn)">
                                Place bet
                            </button>

                        </div>

                    </ng-container>
                </ng-container>
            </ng-container>

        </ng-container>

        <!-- Empty State -->
        <ng-template #empty>
            <div class="has-text-centered has-text-grey mt-4">
                Your betslip is empty. Add some selections to get started.
            </div>
        </ng-template>

    </section>

</ng-template>